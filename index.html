<html>
<head>
  <title>Stats Courses Overview</title>
  <meta charset="utf-8" />
  <script src="d3.min.js"></script>
  <script src="queue.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>


<body>
  <div id="viz">
  </div>

<script>

d3.select("div#viz").append("svg")

queue()
  .defer(d3.json, "classes.json")
  .defer(d3.csv, "relations.csv")
  .await(function(error, classes, relations) { dataViz(classes.all, relations) });


function dataViz(classes, relations) {

  var vizG = d3.select("svg")
               .append("g")
               .attr("id", "vizG")
               .attr("transform", "translate(0, 0)");

  setPositions(classes)
  getLinks(classes, relations)

  addLinks(relations)
  addCircles(classes)
  addLabels(classes)


  function setPositions(nodes) {
    for (i in nodes) {
      if (nodes[i].category == "Math") {
        nodes[i].x = 200
        nodes[i].y = 100 + i * 40
      } else if (nodes[i].category == "Lower") {
        nodes[i].x = 350
        nodes[i].y = 100 + (i-6) * 75
      } else if (nodes[i].category == "100") {
        nodes[i].x = 500
        nodes[i].y = 100 + (i-8) * 75
      } else if (nodes[i].category == "101") {
        nodes[i].x = 650
        nodes[i].y = 100 + (i-11) * 75
      } else if (nodes[i].category == "102") {
        nodes[i].x = 800
        nodes[i].y = 100 + (i-14) * 75
      } else if (nodes[i].category == "Elective") {
        nodes[i].x = 300 + (i-17) * 100
        nodes[i].y = 400
      } else if (nodes[i].category == "Consulting") {
        nodes[i].x = 300 + (i-22) * 100
        nodes[i].y = 500
      }
    }
  }

  function addCircles(nodes) {
    var circles = vizG.selectAll("circle")
    .data(nodes)
    .enter()
    .append("circle")
    .attr("r", function(d) {
                 if (d.category != "Math") {
                   return 16
                 } else {
                   return 11
                 }
               })

    circles.attr("cx", function(d) { return d.x })
    .attr("cy", function(d) { return d.y })
    .attr("fill", function(d) {
      if (d.category == "Math") {
        return "#7DCEA0"
      } else if (d.category == "Elective") {
        return "#D6EAF8"
      } else if (d.category == "Consulting") {
        return "#EB984E"
      } else {
        return "#7FB3D5"
      }
    })
  }

  function addLabels(nodes) {
    vizG.selectAll("text")
    .data(nodes)
    .enter()
    .append("text")
    .attr("x", function(d) { return d.x - 80 })
    .attr("y", function(d) { return d.y })
    .attr("class", "labels")
    .text(function(d) { return d.class })
  }

  function getLinks(nodes, edges) {
    var nodeHash = {}
    for (i in nodes) {
      nodeHash[nodes[i].class] = nodes[i]
    }
    for (i in edges) {
      if (edges[i].requirement == "Enforced") {
        edges[i].weight = 2.5
      } else if (edges[i].requirement == "Choice") {
        edges[i].weight = 1.5
      } else {
        edges[i].weight = 1
      }
      edges[i].source = nodeHash[edges[i].source]
      edges[i].target = nodeHash[edges[i].target]
    }
  }

  function addLinks(edges) {
    vizG.selectAll("line")
        .data(edges)
        .enter()
        .append("line")
        .attr("x1", function(d) { return d.source.x })
        .attr("y1", function(d) { return d.source.y })
        .attr("x2", function(d) { return d.target.x })
        .attr("y2", function(d) { return d.target.y })
        .attr("class", "links")
        .style("stroke", function(d) {
                           if (d.requirement == "Enforced") {
                             return "blue"
                           } else if (d.requirement == "Choice") {
                             return "orange"
                           } else {
                             return "mint"
                           }
                         })
        .style("stroke-width", function(d) { return d.weight })
  }

}

</script>
</body>

</html>
